<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Payment Gateway</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/invoice1.css') }}">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300&display=swap" rel="stylesheet">
    </head>
    <body id="body">
        <div class="container">
            <div class="col-xs-12">
                {% if Price %}
                <div class="invoice-wrapper">
                    <div class="invoice-top">
                        <div class="row">
                            <div class="col-xs-12">
                                <h2 class="title">ใบเสร็จการชำระเงิน</h2>
                            </div>
                            <div class="invoice-number" id="invoice-number">
                                    <h5>เลขที่คำสั่งซื้อ : {{ cart['_id'] }}</h5>
                                    <!-- <h6>วันที่ 30/30/3030</h6>
                                    <h6>เวลา : </h6> -->
                            </div>
                            <div class="customer-address-detail" id="customer-address">
                                    <h5 >รายละเอียดการจัดส่ง</h5>
                                    <h6 class="customer-name">ชื่อ : {{ customer_info['fullname'] }}</h6>
                                    <h6 class="customer-address">ที่อยู่ : {{ customer_info['address'] }} </h6>
                                    <h6 class="customer-phone">หมายเลขโทรศัพท์ : {{ customer_info['tel'] }}</h6>
                            </div>
                        </div>
                    </div>
                    <div class="invoice-bottom">
                            <h5>สรุปรายการสั่งซื้อ</h5>
                            <div class="col-sm-12">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Qty</th>
                                                <th>Description</th>
                                                <th>Price</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for item in cart['cart'] %}
                                            <tr>
                                                <td>{{ item['amount'] }}</td>
                                                <td>{{ item['item_name'] }}</td>
                                                <td>฿{{ item['total_ob'] }}</td>
                                            </tr>
                                            {% endfor %}
                                            <tr style="height: 40px;"></tr>
                                        </tbody>
                                        <thead>
                                            <tr>
                                                <th>Total</th>
                                                <th></th>
                                                <th>฿{{ Price/100 }}</th>
                                            </tr>
                                        </thead>
                                    </table>
                                    <div class="terms" id="terms">
                                        <h4 >Terms</h4>
                                        <ul>
                                            <li>โปรดตรวจสอบรายการคำสั่งซื้อให้ถูกต้อง หากทำการกดยืนยันแล้วจะไม่สามารถแก้ไขได้</li>
                                            <li>Make payment in 2,3 business days.</li>
                                        </ul>
                                    </div>
                            </div>
                    </div>
                </div>
            <div class="button-invoice col-lg-12 col-md-12 col-sm-12 col-xs-12 col-xs-12 d-flex justify-content-center" id="button-invoice">
                    <!-- <button type="button" class="btn btn-success col-xl-2 col-lg-4 col-md-4 col-sm-4 col-xs-12 mx-4">ชำระเงิน</button> -->
                <form id="checkout-form" method="POST" action="/checkout/charge">
                    {% if customer %}
                    <input type="hidden" name="omiseCustomer" value={{ customer }}>
                    <input name="botID" value="{{ botID }}" type="hidden">
                    <input name="userID" type="hidden" id="userID" >
                    {% else %}
                    <input name="botID" value="{{ botID }}" type="hidden">
                    <input name="userID" type="hidden" id="userID" >
                    {% endif %}
                    <script type="text/javascript" src="https://cdn.omise.co/omise.js"
                            data-key="{{ key }}"
                            data-amount={{ Price }}
                            data-currency="{{ currency }}"
                            data-other-payment-methods="{% if currency == "THB" %}truemoney, installment, internet_banking, bill_payment_tesco_lotus, alipay{% endif %}{% if currency == "JPY" %}pay_easy, net_banking, convenience_store{% endif %}"
                            data-default-payment-method="credit_card"
                            data-button-label="จ่าย">
                    </script>
                    <button type="button" id="closewindowbutton" class="btn btn-danger col-xl-2 col-lg-4 col-md-4 col-sm-4 col-xs-12 ">ยกเลิก</button>
                </form>
                {% else %}
                    <h1>ไม่พบตะกร้า โปรดตรวจสอบใหม่อีกครั้ง</h1>
                {% endif %}
                </div>	

            </div>

        
    </div>
        
        <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
        <script src="{{ url_for('static', filename='js/liff-checkout.js') }}"></script>
        <script language="javascript">
            var checkout = document.getElementsByClassName("omise-checkout-button");
            var classList = ["btn", "btn-success", "col-xl-2", "col-lg-4", "col-md-4", "col-sm-4", "col-xs-12", "mx-4"]
            classList.forEach(ele => checkout[0].classList.add(ele))
            main(window.location.href,'{{ liffId }}')
            document.getElementById('closewindowbutton').addEventListener('click', function () {
                liff.closeWindow();
            });
         </script>
    </body>
</html>

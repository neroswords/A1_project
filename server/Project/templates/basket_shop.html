<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
        integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
        integrity="sha512-PgQMlq+nqFLV4ylk1gwUOgm6CtIIXkKwaIHp/PAIWHzig/lKZSEGKEysh0TCVbHJXCLN7WetD8TFecIky75ZfQ=="
        crossorigin="anonymous" />
    <title>ShoppingCart</title>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Mulish:wght@300&display=swap');

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Mulish', sans-serif;
    }

    :root {
        --text-clr: #4f4f4f;
    }

    .RemoveItem,
    .MoveToWishList {
        color: #6c757d;
    }

    a {
        text-decoration: none;
        color: var(--text-clr);
    }

    a:hover {
        text-decoration: none;
        color: var(--text-clr);
    }

    h2 {
        color: var(--text-clr);
        font-size: 1.5rem;
    }

    .main_cart {
        background: #fff;
    }

    .card {
        border: none;
    }

    .product_img img {
        min-width: 200px;
        max-height: 200px;
    }

    .product_name {
        color: black;
        font-size: 1.4rem;
        text-transform: capitalize;
        font-weight: 500;
    }

    .card-title p {
        font-size: 0.9rem;
        font-weight: 500;
    }

    .remove-and-wish p {
        font-size: 0.8rem;
        margin-bottom: 0;
    }

    .price-money h3 {
        font-size: 1rem;
        font-weight: 600;
    }

    .set_quantity {
        position: relative;
    }

    .set_quantity::after {
        /* content: "(Note, 1 piece)"; */
        width: auto;
        height: auto;
        text-align: center;
        position: absolute;
        bottom: -20px;
        right: 1.5rem;
        font-size: 0.8rem;
    }

    .page-link {
        line-height: 16px;
        width: 45px;
        font-size: 1rem;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #495057;
    }

    .page-item input {
        line-height: 22px;
        padding: 3px;
        font-size: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
    }

    .page-link:hover {
        text-decoration: none;
        color: #495057;
        outline: none !important;
    }

    .page-link:focus {
        box-shadow: none;
    }

    .price_indiv p {
        font-size: 1.1rem;
    }

    .fa-heart:hover {
        color: red;
    }

    @media only screen and (max-width: 600px) {

        .RemoveItem,
        .MoveToWishList {
            font-size: 12px;
        }

    }
</style>

<body class="bg-light">
    <form method='post' action='/facebook/{{botID}}/detail/{{userID}}/confirm'>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-10 col-11 mx-auto">
                <div class="row mt-5 gx-3">
                    <div class="col-md-12 col-lg-8 col-11 mx-auto main_cart mb-lg-0 mb-5 shadow">
                        <h2 class="py-4 font-weight-bold">Cart</h2>
                        {% set test = 500 %}
                        {% for i in data[0]['cart'] %}
                        <div class="card p-4">
                        {% set price = i['price_per_ob'] %}
                            <div class="row">
                                <div
                                    class="col-md-5 col-11 mx-auto bg-light d-flex justify-content-center align-items-center shadow product_img">
                                    <img src="/images/bucket/{{i['img_name']}}" class="img-fluid"
                                        alt="cart img">
                                </div>
                                <div class="col-md-7 col-11 mx-auto px-4 mt-2">
                                    <div class="row">
                                        <div class="col-6 card-title">
                                            <h1 class="mb-4 product_name"> {{i['item_name']}}</h1>
                                            
                                            {{price}} per one
                                        
                                        </div>
                                        <div class="col-6">
                                            <ul class="pagination justify-content-end set_quantity">
                                                <li class="page-item">
                                                    <button class="page-link "
                                                        onclick="decreaseNumber('{{[loop.index-1]}}ft','{{[loop.index-1]}}2','{{price}}',event)">
                                                        <i class="fas fa-minus"></i> </button>
                                                </li>
                                                <li class="page-item">
                                                    <input type="text"  class="page-link"
                                                        value="{{i['amount']}}" id="{{[loop.index-1]}}ft"  name="getValue{{loop.index-1}}">
                                                        <!-- <input type="text"  id="{{[loop.index-1]}}ft"  name="getValue{{loop.index-1}}" class="page-link"
                                                        value="{{i['amount']}}"> -->
                                                        <input type="text"  id="getId{{loop.index-1}}" hidden name="getId{{loop.index-1}}" class="page-link"
                                                        value="{{i['itemid']}}" > 
                                                        
                                                </li>
                                                <li class="page-item">
                                                    <button class="page-link"
                                                        onclick="increaseNumber('{{[loop.index-1]}}ft','{{[loop.index-1]}}2','{{price}}',event)">
                                                        <i class="fas fa-plus"></i></button>
                                                </li>
                                                
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-8 d-flex justify-content-between remove_wish">
                                            <p class="RemoveItem"><i class="fas fa-trash-alt" id="RemoveItem"
                                                    onclick="DeleteItem(this,'{{loop.index-1}}')"></i>REMOVE ITEM</p>
                                            <p class="MoveToWishList"><i class="fas fa-heart"></i>MOVE TO WISH LIST </p>
                                        </div>
                                        <div class="col-4 d-flex justify-content-end price_money">
                                            <h3>à¸¿<span id="{{[loop.index-1]}}2" >{{i['total_ob']}} </span></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                          
                        </div>
                        {% endfor %}
                        <!-- <hr /> -->
                    </div>
                    <div class="col-md-12 col-lg-4 col-11 mx-auto mt-lg-0 mt-md-5">
                        <div class="right_side p-3 shadow bg-white">
                            <h2 class="product_name mb-5">The Total Amount Of</h2>
                            <div class="price_indiv d-flex justify-content-between">
                                <p>Product amount</p>
                                <p>$<span id="product_total_amt" >0</span></p>
                            </div>
                            <div class="price_indiv d-flex justify-content-between">
                                <p>Shipping Charge</p>
                                <p>$<span id="shipping_charge" >0</span></p>
                            </div>
                            <hr />
                            <div class="total-amt d-flex justify-content-between font-weight-bold">
                                <p>The total amount of (including VAT)</p>
                                <p>$<span id="total_cart_amt">0.00</span></p>
                            </div>
                            <button  type = "submit" onclick=closeTem() class="btn btn-primary text-uppercase">Checkout</button>
                        </div>
                        <div class="discount_code mt-3 shadow">
                            <div class="card">
                                <div class="card-body">
                                    <a class="d-flex justify-content-between" data-toggle="collapse"
                                        href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                                        Add a discount code (optional)
                                        <span><i class="fas fa-chevron-down pt-1"></i></span>
                                    </a>
                                    <div class="collapse" id="collapseExample">
                                        <div class="mt-3">
                                            <input type="text" name="" id="discount_code1"
                                                class="form-control font-weight-bold"
                                                placeholder="Enter the discount code">
                                            <small id="error_trw" class="text-dark mt-3">A1Chatbot to buy</small>
                                        </div>
                                        <button class="btn btn-primary btn-sm mt-3"
                                            onclick="discount_code(event)">Apply</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 shadow p-3 bg-white">
                            <div class="pt-4">
                                <h5 class="mb-4">Expected delivery date</h5>
                                <p>July 27th 2020 - July 29th 2020</p>
                            </div>
                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"
        integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/"
        crossorigin="anonymous"></script>

    <script type="text/javascript">
           function closeTem() {
            (function (d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) { return; }
                js = d.createElement(s); js.id = id;
                js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, "script", "Messenger"));

            window.extAsyncInit = function () {
                // the Messenger Extensions JS SDK is done loading
                //close the webview
                MessengerExtensions.requestCloseBrowser(function success() {

                }, function error(err) {

                });

            };
        }
        var i 
        var itemlist = []
        for (i = 0; i < 2; i++) 
        {
            var itemprice = document.getElementById("["+i+"]2");
            itemlist.push(itemprice)
            var product_total_amt = document.getElementById('product_total_amt');
            var total_cart_amt = document.getElementById('total_cart_amt');
            var shipping_charge = document.getElementById('shipping_charge');
            product_total_amt.innerHTML = parseInt(product_total_amt.innerHTML)+parseInt(itemprice.innerHTML) ;
            console.log(product_total_amt)
        }
        console.log(product_total_amt.innerHTML )
        total_cart_amt.innerHTML = parseInt(product_total_amt.innerHTML) + parseInt(shipping_charge.innerHTML);
        

        function DeleteItem(btn,t) {
 
            var row = btn.parentNode.parentNode;

            row.parentNode.parentNode.parentNode.parentNode.removeChild(row.parentNode.parentNode.parentNode);
      
            console.log(t)
            // var itemprice = document.getElementById("["+i+"]2");
            console.log(itemlist[t].innerHTML)
            product_total_amt.innerHTML = parseInt(product_total_amt.innerHTML)-parseInt(itemlist[t].innerHTML) ;
            total_cart_amt.innerHTML = parseInt(product_total_amt.innerHTML) + parseInt(shipping_charge.innerHTML);
            
        }
        var product_total_amt = document.getElementById('product_total_amt');
        var shipping_charge = document.getElementById('shipping_charge');
        var total_cart_amt = document.getElementById('total_cart_amt');
        var discountCode = document.getElementById('discount_code1');
        function decreaseNumber(incdec, itemprice,price,e){
            console.log(incdec)
            console.log(itemprice)
            console.log(price)
            e.preventDefault();
            var itemval = document.getElementById(incdec);
            var itemprice = document.getElementById(itemprice);
            if (itemval.value <= 1) {
                itemval.value = 1;
                alert('Negative quantity not allowed');
            } else {
                itemval.value = parseInt(itemval.value) - 1;
                itemval.style.background = '#fff';
                itemval.style.color = '#000';
                itemprice.innerHTML = parseInt(itemprice.innerHTML) -  parseInt(price);

                product_total_amt.innerHTML = parseInt(product_total_amt.innerHTML) -  parseInt(price) ;
                total_cart_amt.innerHTML = parseInt(product_total_amt.innerHTML) + parseInt(shipping_charge.innerHTML);
            }
        

        }

        function increaseNumber(incdec, itemprice,price,e ) {
            
            e.preventDefault();
            var itemval = document.getElementById(incdec);
            var itemprice = document.getElementById(itemprice);
            if (itemval.value >= 20) {
                itemval.value = 20;
                alert('max 20 allowed');
                itemval.style.background = 'red';
                itemval.style.color = '#fff';
            } else {
                itemval.value = parseInt(itemval.value) + 1;
                itemprice.innerHTML = parseInt(itemprice.innerHTML) + parseInt(price);
                product_total_amt.innerHTML = parseInt(product_total_amt.innerHTML) + parseInt(price);
                total_cart_amt.innerHTML = parseInt(product_total_amt.innerHTML) + parseInt(shipping_charge.innerHTML);
            }

        }
        const discount_code = (e) => {
            e.preventDefault();
            let totalamtcurr = parseInt(total_cart_amt.innerHTML);
            let error_trw = document.getElementById('error_trw');
            if (discountCode.value === 'A1Chatbot to buy') {
                let newtotalamt = totalamtcurr - 15;
                total_cart_amt.innerHTML = newtotalamt;
                error_trw.innerHTML = "Hurray! code is valid";
            } else {
                error_trw.innerHTML = "Try Again!";
            }
        }
    </script>
</body>

</html>